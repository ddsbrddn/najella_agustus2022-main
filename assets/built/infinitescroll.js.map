{"version":3,"file":"infinitescroll.js","sources":["infinitescroll.js"],"sourcesContent":["/**\n * Infinite Scroll\n */\n\n(function(window, document) {\n    // next link element\n    var nextElement = document.querySelector('link[rel=next]');\n    if (!nextElement) return;\n\n    // post feed element\n    var feedElement = document.querySelector('.post-feed');\n    if (!feedElement) return;\n\n    var buffer = 300;\n\n    var ticking = false;\n    var loading = false;\n\n    var lastScrollY = window.scrollY;\n    var lastWindowHeight = window.innerHeight;\n    var lastDocumentHeight = document.documentElement.scrollHeight;\n\n    function onPageLoad() {\n        if (this.status === 404) {\n            window.removeEventListener('scroll', onScroll);\n            window.removeEventListener('resize', onResize);\n            return;\n        }\n\n        // append contents\n        var postElements = this.response.querySelectorAll('.post-card');\n        postElements.forEach(function (item) {\n            feedElement.appendChild(item);\n        });\n\n        // set next link\n        var resNextElement = this.response.querySelector('link[rel=next]');\n        if (resNextElement) {\n            nextElement.href = resNextElement.href;\n        } else {\n            window.removeEventListener('scroll', onScroll);\n            window.removeEventListener('resize', onResize);\n        }\n\n        // sync status\n        lastDocumentHeight = document.documentElement.scrollHeight;\n        ticking = false;\n        loading = false;\n    }\n\n    function onUpdate() {\n        // return if already loading\n        if (loading) return;\n\n        // return if not scroll to the bottom\n        if (lastScrollY + lastWindowHeight <= lastDocumentHeight - buffer) {\n            ticking = false;\n            return;\n        }\n\n        loading = true;\n\n        var xhr = new window.XMLHttpRequest();\n        xhr.responseType = 'document';\n\n        xhr.addEventListener('load', onPageLoad);\n\n        xhr.open('GET', nextElement.href);\n        xhr.send(null);\n    }\n\n    function requestTick() {\n        ticking || window.requestAnimationFrame(onUpdate);\n        ticking = true;\n    }\n\n    function onScroll() {\n        lastScrollY = window.scrollY;\n        requestTick();\n    }\n\n    function onResize() {\n        lastWindowHeight = window.innerHeight;\n        lastDocumentHeight = document.documentElement.scrollHeight;\n        requestTick();\n    }\n\n    window.addEventListener('scroll', onScroll, { passive: true });\n    window.addEventListener('resize', onResize);\n\n    requestTick();\n})(window, document);\n"],"names":["window","document","feedElement","buffer","ticking","loading","lastScrollY","lastWindowHeight","lastDocumentHeight","nextElement","querySelector","onPageLoad","resNextElement","this","status","removeEventListener","onScroll","onResize","response","querySelectorAll","forEach","item","appendChild","href","documentElement","scrollHeight","onUpdate","xhr","XMLHttpRequest","responseType","addEventListener","open","send","requestTick","requestAnimationFrame","scrollY","innerHeight","passive"],"mappings":"AAIA,CAAA,SAAUA,EAAQC,GAEd,IAIIC,EAGAC,EAEAC,EACAC,EAEAC,EACAC,EACAC,EAdAC,EAAcR,EAASS,cAAc,gBAAgB,EAgBzD,SAASC,IACL,IAaIC,EAbgB,MAAhBC,KAAKC,QACLd,EAAOe,oBAAoB,SAAUC,CAAQ,EAC7ChB,EAAOe,oBAAoB,SAAUE,CAAQ,IAK9BJ,KAAKK,SAASC,iBAAiB,YAAY,EACjDC,QAAQ,SAAUC,GAC3BnB,EAAYoB,YAAYD,CAAI,CAChC,CAAC,GAGGT,EAAiBC,KAAKK,SAASR,cAAc,gBAAgB,GAE7DD,EAAYc,KAAOX,EAAeW,MAElCvB,EAAOe,oBAAoB,SAAUC,CAAQ,EAC7ChB,EAAOe,oBAAoB,SAAUE,CAAQ,GAIjDT,EAAqBP,EAASuB,gBAAgBC,aAE9CpB,EADAD,EAAU,CAAA,EAEd,CAEA,SAASsB,IAEL,IAUIC,EAVAtB,IAGAC,EAAcC,GAAoBC,EAAqBL,EACvDC,EAAU,CAAA,GAIdC,EAAU,CAAA,GAENsB,EAAM,IAAI3B,EAAO4B,gBACjBC,aAAe,WAEnBF,EAAIG,iBAAiB,OAAQnB,CAAU,EAEvCgB,EAAII,KAAK,MAAOtB,EAAYc,IAAI,EAChCI,EAAIK,KAAK,IAAI,GACjB,CAEA,SAASC,IACL7B,GAAWJ,EAAOkC,sBAAsBR,CAAQ,EAChDtB,EAAU,CAAA,CACd,CAEA,SAASY,IACLV,EAAcN,EAAOmC,QACrBF,EAAY,CAChB,CAEA,SAAShB,IACLV,EAAmBP,EAAOoC,YAC1B5B,EAAqBP,EAASuB,gBAAgBC,aAC9CQ,EAAY,CAChB,CA9EKxB,IAGDP,EAAcD,EAASS,cAAc,YAAY,KAMjDL,EADAD,EAAU,EAFVD,EAAS,KAKTG,EAAcN,EAAOmC,QACrB5B,EAAmBP,EAAOoC,YAC1B5B,EAAqBP,EAASuB,gBAAgBC,aAmElDzB,EAAO8B,iBAAiB,SAAUd,EAAU,CAAEqB,QAAS,CAAA,CAAK,CAAC,EAC7DrC,EAAO8B,iBAAiB,SAAUb,CAAQ,EAE1CgB,EAAY,EACf,EAAEjC,OAAQC,QAAQ"}